<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FYFC 2025 - Quarter Finals Draw Control</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#03bded">
    <link rel="icon" type="image/svg+xml" href="Tounament logo.svg">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Bebas+Neue&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-database-compat.js"></script>
    
    <style>
        :root {
            --primary-color: #03bded;
            --secondary-color: #029ac0;
            --accent-color: #ff6b35;
            --text-color: #fff;
            --bg-color: #0a0b0c;
            --card-bg: #1a1d21;
            --border-color: #2a2f35;
            --success-color: #44ff44;
            --warning-color: #ffaa00;
            --error-color: #ff4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: 
                radial-gradient(ellipse at top, rgba(3, 189, 237, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at bottom, rgba(255, 107, 53, 0.3) 0%, transparent 50%),
                linear-gradient(135deg, #0a0b0c 0%, #1a1d21 50%, #2a2f35 100%);
            background-attachment: fixed;
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .tournament-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 3.5rem;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(3, 189, 237, 0.5);
            margin-bottom: 10px;
            letter-spacing: 3px;
        }

        .control-subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            font-weight: 300;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 30px;
        }

        .back-btn {
            position: absolute;
            top: -10px;
            left: 0;
            background: rgba(26, 29, 33, 0.9);
            color: var(--text-color);
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .back-btn:hover {
            background: var(--primary-color);
            transform: translateY(-2px);
            color: white;
        }

        .navigation {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 40px;
        }

        .nav-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-button:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(3, 189, 237, 0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .section {
            background: rgba(26, 29, 33, 0.6);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .section-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            letter-spacing: 1px;
        }

        .group-standings {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .group {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .group-header {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.2rem;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .team-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid transparent;
        }

        .team-item.winner {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
        }

        .team-item.runner-up {
            background: rgba(192, 192, 192, 0.1);
            border-color: rgba(192, 192, 192, 0.3);
        }

        .position-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 25px;
            height: 20px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .position-indicator.winner {
            background: var(--winner-color);
            color: #000;
        }

        .position-indicator.runner-up {
            background: var(--runner-up-color);
            color: #000;
        }

        .position-indicator.other {
            background: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.7);
        }

        .team-name {
            flex: 1;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .team-points {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--success-color);
        }

        .draw-controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .draw-status {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid;
            font-weight: 600;
        }

        .draw-status.not-ready {
            background: rgba(255, 170, 0, 0.1);
            border-color: var(--warning-color);
            color: var(--warning-color);
        }

        .draw-status.ready {
            background: rgba(68, 255, 68, 0.1);
            border-color: var(--success-color);
            color: var(--success-color);
        }

        .draw-status.completed {
            background: rgba(3, 189, 237, 0.1);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .draw-button {
            background: var(--success-color);
            color: #000;
            border: none;
            padding: 20px 30px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(68, 255, 68, 0.3);
        }

        .draw-button:hover {
            background: #33cc33;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(68, 255, 68, 0.4);
        }

        .draw-button:disabled {
            background: #555;
            color: #999;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .clear-button {
            background: var(--error-color);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .clear-button:hover {
            background: #cc0000;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 68, 68, 0.3);
        }

        .draw-result {
            background: rgba(26, 29, 33, 0.8);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 20px;
        }

        .qf-match {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .qf-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.2rem;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .qf-teams {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .qf-team {
            flex: 1;
            text-align: center;
            font-weight: 600;
        }

        .qf-vs {
            color: var(--accent-color);
            font-weight: 700;
            font-family: 'Bebas Neue', cursive;
            font-size: 1.1rem;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(3, 189, 237, 0.3);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .requirements {
            background: rgba(255, 170, 0, 0.1);
            border: 1px solid var(--warning-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .requirements h4 {
            color: var(--warning-color);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .requirements ul {
            margin-left: 20px;
            color: rgba(255, 255, 255, 0.8);
        }

        .requirements li {
            margin-bottom: 5px;
        }

        /* Logo overlay styles */
        .logo-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: none;
            z-index: 2000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .logo-display {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            position: relative;
        }

        .team-logo-large {
            max-width: 300px;
            max-height: 300px;
            object-fit: contain;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(3, 189, 237, 0.3);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .draw-selection {
            font-family: 'Bebas Neue', cursive;
            font-size: 16rem;
            color: var(--primary-color);
            font-weight: 700;
            letter-spacing: 3px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
            opacity: 0;
            transform: translateX(-100px);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .team-name-display {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            font-weight: 600;
            color: var(--text-color);
            text-align: center;
            opacity: 0.9;
        }

        /* Animation states */
        .logo-overlay.selecting .team-logo-large {
            transform: translateX(100px) scale(0.8);
        }

        .logo-overlay.selecting .draw-selection {
            opacity: 1;
            transform: translateX(-50px);
        }

        .logo-overlay.closing {
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }

        .logo-overlay.closing .team-logo-large {
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }

        .logo-overlay.selecting.closing .team-logo-large {
            transform: translateX(150px) scale(0.8);
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }

        .logo-overlay.closing .draw-selection {
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }

        .logo-overlay.selecting.closing .draw-selection {
            transform: translateX(0);
            opacity: 0;
            transition: opacity 1.1s ease-in-out;
        }

        /* Manual Selection Modal */
        .selection-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            z-index: 3000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .modal-content {
            background: rgba(26, 29, 33, 0.95);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.8rem;
            color: var(--primary-color);
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .team-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .team-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .team-option:hover {
            background: rgba(3, 189, 237, 0.1);
            border-color: rgba(3, 189, 237, 0.3);
            transform: translateY(-2px);
        }

        .team-option.selected {
            background: rgba(3, 189, 237, 0.2);
            border-color: var(--primary-color);
        }

        .team-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(255, 255, 255, 0.02);
        }

        .team-option.disabled:hover {
            transform: none;
            border-color: rgba(255, 255, 255, 0.1);
        }

        .team-option-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-color);
            flex-shrink: 0;
        }

        .team-option-placeholder {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: var(--primary-color);
            flex-shrink: 0;
        }

        .team-option-info {
            flex: 1;
        }

        .team-option-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .team-option-position {
            font-size: 0.8rem;
            color: var(--primary-color);
            text-transform: uppercase;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: flex-end;
        }

        .modal-button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-button.primary {
            background: var(--primary-color);
            color: white;
        }

        .modal-button.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
        }

        .modal-button:hover {
            transform: translateY(-2px);
        }

        .manual-draw-section {
            background: rgba(26, 29, 33, 0.8);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .manual-draw-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }

        .qf-setup-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .qf-setup-match {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .qf-setup-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.3rem;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 15px;
        }

        .qf-setup-teams {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .qf-team-slot {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qf-team-slot:hover {
            border-color: var(--primary-color);
            background: rgba(3, 189, 237, 0.1);
        }

        .qf-team-slot.filled {
            border-style: solid;
            border-color: var(--primary-color);
            background: rgba(3, 189, 237, 0.1);
        }

        .qf-team-slot.filled:hover {
            border-color: var(--accent-color);
            background: rgba(255, 107, 53, 0.1);
        }

        .qf-slot-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .qf-slot-logo {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-color);
            flex-shrink: 0;
        }

        .qf-slot-info {
            flex: 1;
            text-align: left;
        }

        .qf-slot-name {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .qf-slot-position {
            font-size: 0.7rem;
            color: var(--primary-color);
            text-transform: uppercase;
        }

        .qf-slot-empty {
            color: rgba(255, 255, 255, 0.5);
            font-style: italic;
        }

        .qf-vs {
            color: var(--accent-color);
            font-weight: 700;
            font-family: 'Bebas Neue', cursive;
            font-size: 1.2rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .save-manual-draw {
            background: var(--success-color);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(68, 255, 68, 0.3);
        }

        .save-manual-draw:hover {
            background: #33cc33;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(68, 255, 68, 0.4);
        }

        .save-manual-draw:disabled {
            background: #555;
            color: #999;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .group-standings {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .tournament-title {
                font-size: 2.5rem;
            }

            .qf-setup-teams {
                flex-direction: column;
                gap: 15px;
            }

            .qf-vs {
                transform: rotate(90deg);
                margin: 10px 0;
            }

            .team-selection-grid {
                grid-template-columns: 1fr;
            }

            .draw-selection {
                font-size: 8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="match-management.html" class="back-btn">← Back to Home</a>
        
        <div class="header">
            <h1 class="tournament-title">FYFC 2025</h1>
            <p class="control-subtitle">Quarter Finals Draw Control</p>
        </div>

        <div class="navigation">
            <a href="qf-draw-display.html" class="nav-button">View Draw Display</a>
            <a href="team-standings.html" class="nav-button">View Standings</a>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            Loading tournament data...
        </div>

        <div class="main-content" id="main-content" style="display: none;">
            <div class="section">
                <h2 class="section-title">Group Standings</h2>
                <div class="group-standings" id="group-standings">
                    <!-- Groups will be populated here -->
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Draw Control</h2>
                
                <div class="requirements">
                    <h4>Requirements for Quarter Finals Draw:</h4>
                    <ul>
                        <li>All group stage matches must be completed</li>
                        <li>Clear group winners and runners-up identified</li>
                        <li>Minimum 2 teams qualified from each group</li>
                    </ul>
                </div>

                <div class="draw-controls">
                    <div class="draw-status" id="draw-status">
                        Checking requirements...
                    </div>
                    
                    <button class="draw-button" id="conduct-draw" onclick="conductDraw()" disabled>
                        Conduct Random Draw
                    </button>

                    <button class="draw-button" id="manual-draw" onclick="setupManualDraw()" disabled style="background: var(--primary-color); margin-top: 10px;">
                        Manual Team Selection
                    </button>
                    
                    <button class="clear-button" id="clear-draw" onclick="clearDraw()" style="display: none;">
                        Clear Draw & Restart
                    </button>
                </div>
            </div>
        </div>

        <div class="manual-draw-section" id="manual-draw-section" style="display: none;">
            <h2 class="manual-draw-title">Manual Quarter Finals Draw Setup</h2>
            <div class="qf-setup-grid" id="qf-setup-grid">
                <!-- Quarter final setup will be populated here -->
            </div>
            <button class="save-manual-draw" id="save-manual-draw" onclick="saveManualDraw()" disabled>
                Save Manual Draw
            </button>
        </div>

        <div class="draw-result" id="draw-result" style="display: none;">
            <h2 class="section-title">Quarter Finals Draw Result</h2>
            <div id="qf-matches">
                <!-- Quarter final matches will be shown here -->
            </div>
        </div>
    </div>

    <!-- Logo overlay for team selection -->
    <div class="logo-overlay" id="logo-overlay">
        <div class="logo-display">
            <div class="draw-selection" id="draw-selection"></div>
            <img class="team-logo-large" id="team-logo-large" alt="Team Logo">
            <div class="team-name-display" id="team-name-display"></div>
        </div>
    </div>

    <!-- Manual team selection modal -->
    <div class="selection-modal" id="selection-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Select Team</h3>
                <button class="close-modal" onclick="closeSelectionModal()">&times;</button>
            </div>
            <div class="team-selection-grid" id="team-selection-grid">
                <!-- Team options will be populated here -->
            </div>
            <div class="modal-actions">
                <button class="modal-button secondary" onclick="closeSelectionModal()">Cancel</button>
                <button class="modal-button primary" id="confirm-selection" onclick="confirmTeamSelection()" disabled>Select Team</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCapatOZLxm387yKpFUPD-K8Dv24UBcP9k",
            authDomain: "exvertixe-futsal.firebaseapp.com",
            databaseURL: "https://exvertixe-futsal-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "exvertixe-futsal",
            storageBucket: "exvertixe-futsal.firebasestorage.app",
            messagingSenderId: "992942970225",
            appId: "1:992942970225:web:25bd160a3ac2139b5612d0",
            measurementId: "G-130DYDBMF6"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global data storage
        let teams = {};
        let drawAssignments = {};
        let matchEvents = {};
        let matchScores = {};
        let matchState = {};
        let quarterFinalDraw = {};
        let teamStandings = {};

        // Team name to logo filename mapping
        function getTeamLogoFilename(teamName) {
            const logoMap = {
                'Amigos': 'amigos',
                'Best': 'best',
                'Brave Generation Sports Club': 'brave_generation_sports_club',
                'Foemathi': 'foemathi',
                'Foemathi Jr': 'foemathi_jr',
                'Goalhians': 'goalhians',
                'Goalhi Sports Club': 'goalhi_sports_club',
                'G Star Sports Club': 'g_star_sports_club',
                'Kanmathi FC': 'kanmathi_fc',
                'Kanmathi SC': 'kanmathi_sc',
                'Laamu Blues': 'laamu_blues',
                'LeCrose Sports Club': 'lecrose_sports_club',
                'Maahinna United': 'maahinna_united',
                'Outreef Sports Club': 'outreef_sports_club',
                'Youth Academy': 'youth_academy'
            };
            
            return logoMap[teamName] || teamName.replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, '_').toLowerCase();
        }

        // Get team data from position
        function getTeamData(position) {
            if (!drawAssignments[position] || !teams[drawAssignments[position]]) {
                return null;
            }
            
            const teamId = drawAssignments[position];
            const team = teams[teamId];
            
            return {
                id: teamId,
                name: team.teamName,
                logo: getTeamLogoFilename(team.teamName),
                position: position
            };
        }

        // Calculate match score from various sources
        function getMatchScore(matchId) {
            // Try matchScores first
            if (matchScores[matchId] && typeof matchScores[matchId] === 'object') {
                const score = matchScores[matchId];
                if (typeof score.team1Score === 'number' && typeof score.team2Score === 'number') {
                    return { team1: score.team1Score, team2: score.team2Score };
                }
            }
            
            // Try matchEvents for goal counting
            if (matchEvents[matchId]) {
                const events = matchEvents[matchId];
                let team1Goals = 0;
                let team2Goals = 0;
                
                Object.values(events).forEach(event => {
                    if (event.eventType === 'goal') {
                        if (event.team === 'team1') team1Goals++;
                        else if (event.team === 'team2') team2Goals++;
                    }
                });
                
                return { team1: team1Goals, team2: team2Goals };
            }
            
            return { team1: 0, team2: 0 };
        }

        // Get all group stage matches
        function getGroupStageMatches() {
            const matchSchedule = {
                'October 26': [
                    { teams: ['A1', 'A2'], type: 'Group A', time: '4:00 PM' },
                    { teams: ['A3', 'A4'], type: 'Group A', time: '5:00 PM' },
                    { teams: ['B1', 'B2'], type: 'Group B', time: '8:00 PM' },
                    { teams: ['C1', 'C2'], type: 'Group C', time: '9:00 PM' },
                    { teams: ['D1', 'D2'], type: 'Group D', time: '10:00 PM' }
                ],
                'October 27': [
                    { teams: ['A1', 'A3'], type: 'Group A', time: '8:15 PM' },
                    { teams: ['A2', 'A4'], type: 'Group A', time: '9:15 PM' },
                    { teams: ['B1', 'B3'], type: 'Group B', time: '10:15 PM' }
                ],
                'October 28': [
                    { teams: ['C1', 'C3'], type: 'Group C', time: '8:15 PM' },
                    { teams: ['D1', 'D3'], type: 'Group D', time: '9:15 PM' },
                    { teams: ['B2', 'B3'], type: 'Group B', time: '10:15 PM' }
                ],
                'October 29': [
                    { teams: ['A1', 'A4'], type: 'Group A', time: '8:15 PM' },
                    { teams: ['A2', 'A3'], type: 'Group A', time: '9:15 PM' },
                    { teams: ['C2', 'C3'], type: 'Group C', time: '10:15 PM' }
                ],
                'October 30': [
                    { teams: ['D2', 'D3'], type: 'Group D', time: '9:15 PM' }
                ]
            };

            const matches = [];
            
            for (const date of Object.keys(matchSchedule)) {
                for (const match of matchSchedule[date]) {
                    const dateParts = date.toLowerCase().split(' ');
                    const dateStr = `${dateParts[0]}${dateParts[1]}`;
                    const timeFormatted = match.time.replace(/[^0-9]/g, '');
                    const matchId = `${dateStr}-${match.teams[0]}vs${match.teams[1]}-${timeFormatted}`;
                    
                    matches.push({
                        id: matchId,
                        teams: match.teams,
                        group: match.teams[0].charAt(0),
                        date: date,
                        time: match.time
                    });
                }
            }
            
            return matches;
        }

        // Calculate team standings based on match results
        function calculateStandings() {
            const standings = {};
            
            // Initialize team standings
            const positions = ['A1', 'A2', 'A3', 'A4', 'B1', 'B2', 'B3', 'C1', 'C2', 'C3', 'D1', 'D2', 'D3'];
            positions.forEach(position => {
                if (drawAssignments[position]) {
                    standings[position] = {
                        position: position,
                        group: position.charAt(0),
                        matchesPlayed: 0,
                        wins: 0,
                        draws: 0,
                        losses: 0,
                        points: 0,
                        goalsScored: 0,
                        goalsConceded: 0,
                        goalDifference: 0
                    };
                }
            });

            // Process all group stage matches
            const matches = getGroupStageMatches();
            
            matches.forEach(match => {
                const matchId = match.id;
                const state = matchState[matchId]?.state;
                
                // Only process finished matches
                if (state === 'finished') {
                    const score = getMatchScore(matchId);
                    const team1Position = match.teams[0];
                    const team2Position = match.teams[1];
                    
                    if (standings[team1Position] && standings[team2Position]) {
                        // Update matches played
                        standings[team1Position].matchesPlayed++;
                        standings[team2Position].matchesPlayed++;
                        
                        // Update goals
                        standings[team1Position].goalsScored += score.team1;
                        standings[team1Position].goalsConceded += score.team2;
                        standings[team2Position].goalsScored += score.team2;
                        standings[team2Position].goalsConceded += score.team1;
                        
                        // Update results
                        if (score.team1 > score.team2) {
                            // Team 1 wins
                            standings[team1Position].wins++;
                            standings[team1Position].points += 3;
                            standings[team2Position].losses++;
                        } else if (score.team2 > score.team1) {
                            // Team 2 wins
                            standings[team2Position].wins++;
                            standings[team2Position].points += 3;
                            standings[team1Position].losses++;
                        } else {
                            // Draw
                            standings[team1Position].draws++;
                            standings[team1Position].points += 1;
                            standings[team2Position].draws++;
                            standings[team2Position].points += 1;
                        }
                        
                        // Update goal difference
                        standings[team1Position].goalDifference = 
                            standings[team1Position].goalsScored - standings[team1Position].goalsConceded;
                        standings[team2Position].goalDifference = 
                            standings[team2Position].goalsScored - standings[team2Position].goalsConceded;
                    }
                }
            });

            return standings;
        }

        // Get qualified teams (winners and runners-up from each group)
        function getQualifiedTeams() {
            const standings = calculateStandings();
            const groups = ['A', 'B', 'C', 'D'];
            const qualified = {
                winners: [],
                runnersUp: []
            };
            
            groups.forEach(groupLetter => {
                const groupTeams = Object.values(standings)
                    .filter(team => team.group === groupLetter && drawAssignments[team.position])
                    .sort((a, b) => {
                        if (b.points !== a.points) return b.points - a.points;
                        if (b.goalDifference !== a.goalDifference) return b.goalDifference - a.goalDifference;
                        return b.goalsScored - a.goalsScored;
                    });
                
                if (groupTeams.length >= 2) {
                    qualified.winners.push(groupTeams[0].position);
                    qualified.runnersUp.push(groupTeams[1].position);
                }
            });
            
            return qualified;
        }

        // Check if draw requirements are met
        function checkDrawRequirements() {
            const matches = getGroupStageMatches();
            const totalMatches = matches.length;
            const finishedMatches = matches.filter(match => 
                matchState[match.id]?.state === 'finished'
            ).length;
            
            const qualified = getQualifiedTeams();
            const hasEnoughTeams = qualified.winners.length >= 4 && qualified.runnersUp.length >= 4;
            const allMatchesComplete = finishedMatches === totalMatches;
            
            return {
                allMatchesComplete,
                hasEnoughTeams,
                finishedMatches,
                totalMatches,
                qualified
            };
        }

        // Update draw status and controls
        function updateDrawStatus() {
            const statusElement = document.getElementById('draw-status');
            const conductButton = document.getElementById('conduct-draw');
            const manualButton = document.getElementById('manual-draw');
            const clearButton = document.getElementById('clear-draw');
            const requirements = checkDrawRequirements();
            const hasExistingDraw = Object.keys(quarterFinalDraw).length > 0;
            
            if (hasExistingDraw) {
                statusElement.textContent = 'Quarter Finals Draw Complete';
                statusElement.className = 'draw-status completed';
                conductButton.style.display = 'none';
                manualButton.style.display = 'none';
                clearButton.style.display = 'block';
                
                // Hide manual draw section if visible
                const manualSection = document.getElementById('manual-draw-section');
                if (manualSection) {
                    manualSection.style.display = 'none';
                }
                
                displayDrawResult();
            } else if (requirements.allMatchesComplete && requirements.hasEnoughTeams) {
                statusElement.textContent = 'Ready to Conduct Draw';
                statusElement.className = 'draw-status ready';
                conductButton.disabled = false;
                conductButton.style.display = 'block';
                manualButton.disabled = false;
                manualButton.style.display = 'block';
                clearButton.style.display = 'none';
            } else {
                let message = 'Requirements not met for random draw: ';
                const issues = [];
                if (!requirements.allMatchesComplete) {
                    issues.push(`${requirements.finishedMatches}/${requirements.totalMatches} matches complete`);
                }
                if (!requirements.hasEnoughTeams) {
                    issues.push('need qualified teams from all groups');
                }
                message += issues.join(', ');
                message += ' - Manual selection is always available';
                
                statusElement.textContent = message;
                statusElement.className = 'draw-status not-ready';
                conductButton.disabled = true;
                manualButton.disabled = false; // Manual selection is always available
                manualButton.style.display = 'block';
                clearButton.style.display = 'none';
                
                // Hide manual draw section if visible
                const manualSection = document.getElementById('manual-draw-section');
                if (manualSection) {
                    manualSection.style.display = 'none';
                }
            }
        }

        // Display group standings
        function displayGroupStandings() {
            const container = document.getElementById('group-standings');
            const standings = calculateStandings();
            const groups = ['A', 'B', 'C', 'D'];
            
            container.innerHTML = '';
            
            groups.forEach(groupLetter => {
                const groupTeams = Object.values(standings)
                    .filter(team => team.group === groupLetter)
                    .sort((a, b) => {
                        if (b.points !== a.points) return b.points - a.points;
                        if (b.goalDifference !== a.goalDifference) return b.goalDifference - a.goalDifference;
                        return b.goalsScored - a.goalsScored;
                    });
                
                const groupDiv = document.createElement('div');
                groupDiv.className = 'group';
                
                const header = document.createElement('div');
                header.className = 'group-header';
                header.textContent = `GROUP ${groupLetter}`;
                groupDiv.appendChild(header);
                
                groupTeams.forEach((team, index) => {
                    const teamData = getTeamData(team.position);
                    const teamDiv = document.createElement('div');
                    teamDiv.className = 'team-item';
                    
                    let positionClass = 'other';
                    let positionText = (index + 1).toString();
                    
                    if (index === 0) {
                        positionClass = 'winner';
                        positionText = '🥇';
                        teamDiv.classList.add('winner');
                    } else if (index === 1) {
                        positionClass = 'runner-up';
                        positionText = '🥈';
                        teamDiv.classList.add('runner-up');
                    }
                    
                    teamDiv.innerHTML = `
                        <div class="position-indicator ${positionClass}">${positionText}</div>
                        <div class="team-name">${teamData ? teamData.name : team.position}</div>
                        <div class="team-points">${team.points}pts</div>
                    `;
                    
                    groupDiv.appendChild(teamDiv);
                });
                
                container.appendChild(groupDiv);
            });
        }

        // Global variables for manual draw
        let manualDrawData = {
            QF1: { team1: null, team2: null },
            QF2: { team1: null, team2: null },
            QF3: { team1: null, team2: null },
            QF4: { team1: null, team2: null }
        };
        let currentSelectionSlot = null;
        let selectedTeamId = null;
        let selectedPosition = null;
        let currentDisplayTeam = null;
        let logoDisplayTimeout = null;

        // Logo display functions
        function showTeamLogo(teamId) {
            console.log('showTeamLogo called with:', teamId);
            
            const overlay = document.getElementById('logo-overlay');
            const logo = document.getElementById('team-logo-large');
            const teamNameDisplay = document.getElementById('team-name-display');
            const drawSelection = document.getElementById('draw-selection');

            if (!overlay || !logo || !teamNameDisplay || !drawSelection) {
                console.error('Logo overlay elements not found!');
                return;
            }

            const team = teams[teamId];
            if (!team) {
                console.error('Team not found:', teamId);
                return;
            }

            const logoFileName = getTeamLogoFilename(team.teamName);
            console.log('Logo filename:', logoFileName);
            
            logo.style.display = 'block';
            logo.src = `logos/${logoFileName}.jpg`;
            
            logo.onerror = () => {
                console.log('JPG failed, trying PNG');
                logo.src = `logos/${logoFileName}.png`;
                logo.onerror = () => {
                    console.log('Both JPG and PNG failed, hiding logo');
                    logo.style.display = 'none';
                    teamNameDisplay.style.fontSize = '4rem';
                    teamNameDisplay.style.color = 'var(--primary-color)';
                };
            };
            
            logo.onload = () => {
                console.log('Logo loaded successfully');
            };

            teamNameDisplay.textContent = team.teamName;
            teamNameDisplay.style.fontSize = '2rem';
            teamNameDisplay.style.color = 'var(--text-color)';
            currentDisplayTeam = teamId;

            // Reset animation states
            overlay.classList.remove('closing');
            overlay.style.opacity = '0';

            // Show overlay with animation
            overlay.style.display = 'flex';
            overlay.offsetHeight;
            overlay.style.opacity = '1';
            
            console.log('Logo overlay should now be visible');
        }

        function showDrawSelection(position) {
            const overlay = document.getElementById('logo-overlay');
            const drawSelection = document.getElementById('draw-selection');

            if (!overlay || !drawSelection) {
                console.error('Missing overlay or drawSelection elements');
                return;
            }

            drawSelection.textContent = position;
            overlay.classList.add('selecting');
            console.log('Draw selection shown:', position);
        }

        function hideTeamLogo() {
            console.log('hideTeamLogo called');
            const overlay = document.getElementById('logo-overlay');
            
            if (!overlay) {
                console.error('Logo overlay element not found in hideTeamLogo');
                return;
            }
            
            clearTimeout(logoDisplayTimeout);
            
            if (overlay.style.display === 'flex') {
                overlay.classList.add('closing');
                console.log('Starting close animation');
                
                setTimeout(() => {
                    overlay.style.display = 'none';
                    overlay.classList.remove('selecting', 'closing');
                    
                    const drawSelection = document.getElementById('draw-selection');
                    if (drawSelection) {
                        drawSelection.textContent = '';
                    }
                    
                    const logo = document.getElementById('team-logo-large');
                    if (logo) {
                        logo.style.transform = '';
                        logo.style.opacity = '';
                    }
                    
                    overlay.style.opacity = '';
                    currentDisplayTeam = null;
                    console.log('Logo overlay hidden');
                }, 800);
            }
        }

        // Manual draw setup
        function setupManualDraw() {
            console.log('Setting up manual draw');
            
            // Reset manual draw data
            manualDrawData = {
                QF1: { team1: null, team2: null },
                QF2: { team1: null, team2: null },
                QF3: { team1: null, team2: null },
                QF4: { team1: null, team2: null }
            };

            // Show manual draw section
            const manualSection = document.getElementById('manual-draw-section');
            const drawResult = document.getElementById('draw-result');
            
            manualSection.style.display = 'block';
            drawResult.style.display = 'none';

            // Create manual draw UI
            createManualDrawUI();
        }

        function createManualDrawUI() {
            const setupGrid = document.getElementById('qf-setup-grid');
            setupGrid.innerHTML = '';

            for (let i = 1; i <= 4; i++) {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'qf-setup-match';
                matchDiv.innerHTML = `
                    <div class="qf-setup-title">QUARTER FINAL ${i}</div>
                    <div class="qf-setup-teams">
                        <div class="qf-team-slot" id="qf${i}-team1-slot" onclick="selectTeamForSlot('QF${i}', 'team1', 'team1')">
                            <div class="qf-slot-empty">Click to select Team 1</div>
                        </div>
                        <div class="qf-vs">VS</div>
                        <div class="qf-team-slot" id="qf${i}-team2-slot" onclick="selectTeamForSlot('QF${i}', 'team2', 'team2')">
                            <div class="qf-slot-empty">Click to select Team 2</div>
                        </div>
                    </div>
                `;
                setupGrid.appendChild(matchDiv);
            }

            updateSaveButtonState();
        }

        function selectTeamForSlot(qfMatch, teamSlot, type) {
            console.log('Selecting team for:', qfMatch, teamSlot, type);
            
            currentSelectionSlot = { qfMatch, teamSlot, type };
            
            // Show selection modal
            showSelectionModal(type);
        }

        function showSelectionModal(type) {
            const modal = document.getElementById('selection-modal');
            const modalTitle = document.getElementById('modal-title');
            const selectionGrid = document.getElementById('team-selection-grid');
            
            modalTitle.textContent = `Select Team for ${currentSelectionSlot.qfMatch} - ${currentSelectionSlot.teamSlot === 'team1' ? 'Team 1' : 'Team 2'}`;
            
            // Clear previous selections
            selectedTeamId = null;
            selectedPosition = null;
            document.getElementById('confirm-selection').disabled = true;
            
            // Populate team options
            populateTeamOptions(type, selectionGrid);
            
            // Show modal
            modal.style.display = 'flex';
            modal.offsetHeight;
            modal.style.opacity = '1';
        }

        function populateTeamOptions(type, container) {
            container.innerHTML = '';
            
            // Collect already selected teams
            const usedTeams = new Set();
            Object.values(manualDrawData).forEach(qf => {
                if (qf.team1) usedTeams.add(qf.team1);
                if (qf.team2) usedTeams.add(qf.team2);
            });

            // Add all available teams from draw assignments (not restricted by standings)
            Object.entries(drawAssignments).forEach(([position, teamId]) => {
                const teamData = getTeamData(position);
                if (teamData) {
                    const isUsed = usedTeams.has(position);
                    
                    const teamOption = document.createElement('div');
                    teamOption.className = `team-option ${isUsed ? 'disabled' : ''}`;
                    teamOption.setAttribute('data-team-id', teamData.id);
                    teamOption.setAttribute('data-position', position);
                    
                    if (!isUsed) {
                        teamOption.onclick = () => selectTeamOption(teamData.id, position);
                    }
                    
                    teamOption.innerHTML = `
                        <img class="team-option-logo" src="logos/${teamData.logo}.jpg" 
                             alt="${teamData.name}" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="team-option-placeholder" style="display: none;">${position}</div>
                        <div class="team-option-info">
                            <div class="team-option-name">${teamData.name}</div>
                            <div class="team-option-position">Group ${position.charAt(0)} - Position ${position}</div>
                        </div>
                    `;
                    
                    container.appendChild(teamOption);
                }
            });
        }

        function selectTeamOption(teamId, position) {
            // Remove previous selection
            document.querySelectorAll('.team-option.selected').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Select current option
            const option = document.querySelector(`[data-team-id="${teamId}"]`);
            if (option && !option.classList.contains('disabled')) {
                option.classList.add('selected');
                selectedTeamId = teamId;
                selectedPosition = position;
                document.getElementById('confirm-selection').disabled = false;
                
                // Show team logo
                showTeamLogo(teamId);
                showDrawSelection(position);
            }
        }

        function confirmTeamSelection() {
            if (!selectedTeamId || !currentSelectionSlot) return;
            
            const { qfMatch, teamSlot } = currentSelectionSlot;
            
            // Update manual draw data
            manualDrawData[qfMatch][teamSlot] = selectedPosition;
            
            // Update UI slot
            updateTeamSlot(qfMatch, teamSlot);
            
            // Close modal
            closeSelectionModal();
            
            // Update save button state
            updateSaveButtonState();
        }

        function closeSelectionModal() {
            const modal = document.getElementById('selection-modal');
            modal.style.opacity = '0';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
            
            // Hide logo overlay
            hideTeamLogo();
            
            // Reset selection state
            selectedTeamId = null;
            selectedPosition = null;
            currentSelectionSlot = null;
        }

        function updateTeamSlot(qfMatch, teamSlot) {
            const slotElement = document.getElementById(`${qfMatch.toLowerCase()}-${teamSlot}-slot`);
            const position = manualDrawData[qfMatch][teamSlot];
            
            if (position && slotElement) {
                const teamData = getTeamData(position);
                
                if (teamData) {
                    slotElement.classList.add('filled');
                    slotElement.innerHTML = `
                        <div class="qf-slot-content">
                            <img class="qf-slot-logo" src="logos/${teamData.logo}.jpg" 
                                 alt="${teamData.name}" 
                                 onerror="this.style.display='none';">
                            <div class="qf-slot-info">
                                <div class="qf-slot-name">${teamData.name}</div>
                                <div class="qf-slot-position">Group ${position.charAt(0)} - Position ${position}</div>
                            </div>
                        </div>
                    `;
                }
            }
        }

        function updateSaveButtonState() {
            const saveButton = document.getElementById('save-manual-draw');
            const isComplete = Object.values(manualDrawData).every(qf => qf.team1 && qf.team2);
            saveButton.disabled = !isComplete;
        }

        function saveManualDraw() {
            console.log('Saving manual draw:', manualDrawData);
            
            // Convert to the expected format
            const drawToSave = {};
            Object.entries(manualDrawData).forEach(([qfKey, qfData]) => {
                if (qfData.team1 && qfData.team2) {
                    drawToSave[qfKey] = {
                        team1: qfData.team1,
                        team2: qfData.team2
                    };
                }
            });
            
            // Save to Firebase
            database.ref('quarterFinalDraw').set(drawToSave)
                .then(() => {
                    console.log('Manual quarter finals draw saved successfully!');
                    
                    // Hide manual draw section
                    document.getElementById('manual-draw-section').style.display = 'none';
                    
                    // Update draw status
                    updateDrawStatus();
                    
                    alert('Quarter Finals draw has been set successfully!');
                })
                .catch(error => {
                    console.error('Error saving manual draw:', error);
                    alert('Error saving draw. Please try again.');
                });
        }

        // Conduct the quarter finals draw
        function conductDraw() {
            const requirements = checkDrawRequirements();
            if (!requirements.allMatchesComplete || !requirements.hasEnoughTeams) {
                alert('Draw requirements not met!');
                return;
            }
            
            const qualified = requirements.qualified;
            console.log('Conducting draw with qualified teams:', qualified);
            
            // Shuffle the runners-up for random draw
            const shuffledRunnersUp = [...qualified.runnersUp].sort(() => Math.random() - 0.5);
            
            // Create the draw avoiding same-group matchups
            const draw = {};
            const usedRunners = new Set();
            
            // Assign winners to first slots and find suitable runners-up
            qualified.winners.forEach((winner, index) => {
                const qfNum = index + 1;
                const winnerGroup = winner.charAt(0);
                
                // Find a runner-up from a different group
                const availableRunners = shuffledRunnersUp.filter(runner => 
                    !usedRunners.has(runner) && runner.charAt(0) !== winnerGroup
                );
                
                if (availableRunners.length > 0) {
                    const selectedRunner = availableRunners[0];
                    draw[`QF${qfNum}`] = {
                        team1: winner,
                        team2: selectedRunner
                    };
                    usedRunners.add(selectedRunner);
                } else {
                    // Fallback: use any available runner-up (shouldn't happen with proper groups)
                    const fallbackRunner = shuffledRunnersUp.find(runner => !usedRunners.has(runner));
                    if (fallbackRunner) {
                        draw[`QF${qfNum}`] = {
                            team1: winner,
                            team2: fallbackRunner
                        };
                        usedRunners.add(fallbackRunner);
                    }
                }
            });
            
            console.log('Generated draw:', draw);
            
            // Save to Firebase
            database.ref('quarterFinalDraw').set(draw)
                .then(() => {
                    console.log('Quarter finals draw saved successfully!');
                    updateDrawStatus();
                })
                .catch(error => {
                    console.error('Error saving draw:', error);
                    alert('Error saving draw. Please try again.');
                });
        }

        // Clear the draw
        function clearDraw() {
            if (confirm('Are you sure you want to clear the quarter finals draw? This cannot be undone.')) {
                database.ref('quarterFinalDraw').remove()
                    .then(() => {
                        console.log('Quarter finals draw cleared');
                        document.getElementById('draw-result').style.display = 'none';
                        updateDrawStatus();
                    })
                    .catch(error => {
                        console.error('Error clearing draw:', error);
                        alert('Error clearing draw. Please try again.');
                    });
            }
        }

        // Display draw result
        function displayDrawResult() {
            const resultContainer = document.getElementById('draw-result');
            const matchesContainer = document.getElementById('qf-matches');
            
            if (Object.keys(quarterFinalDraw).length === 0) {
                resultContainer.style.display = 'none';
                return;
            }
            
            resultContainer.style.display = 'block';
            matchesContainer.innerHTML = '';
            
            for (let i = 1; i <= 4; i++) {
                const qfData = quarterFinalDraw[`QF${i}`];
                if (qfData) {
                    const team1Data = getTeamData(qfData.team1);
                    const team2Data = getTeamData(qfData.team2);
                    
                    const matchDiv = document.createElement('div');
                    matchDiv.className = 'qf-match';
                    matchDiv.innerHTML = `
                        <div class="qf-title">QUARTER FINAL ${i}</div>
                        <div class="qf-teams">
                            <div class="qf-team">
                                ${team1Data ? team1Data.name : qfData.team1}
                                <br><small>Group ${qfData.team1.charAt(0)} Winner 🥇</small>
                            </div>
                            <div class="qf-vs">VS</div>
                            <div class="qf-team">
                                ${team2Data ? team2Data.name : qfData.team2}
                                <br><small>Group ${qfData.team2.charAt(0)} Runner-up 🥈</small>
                            </div>
                        </div>
                    `;
                    
                    matchesContainer.appendChild(matchDiv);
                }
            }
        }

        // Firebase listeners
        function setupFirebaseListeners() {
            // Listen for team data
            database.ref('applications').on('value', (snapshot) => {
                teams = snapshot.val() || {};
                console.log('Teams updated:', Object.keys(teams).length);
                displayGroupStandings();
                updateDrawStatus();
            });

            // Listen for draw assignments
            database.ref('drawAssignments').on('value', (snapshot) => {
                drawAssignments = snapshot.val() || {};
                console.log('Draw assignments updated:', Object.keys(drawAssignments).length);
                displayGroupStandings();
                updateDrawStatus();
            });

            // Listen for match events
            database.ref('matchEvents').on('value', (snapshot) => {
                matchEvents = snapshot.val() || {};
                console.log('Match events updated:', Object.keys(matchEvents).length);
                displayGroupStandings();
                updateDrawStatus();
            });

            // Listen for match scores
            database.ref('matchScores').on('value', (snapshot) => {
                matchScores = snapshot.val() || {};
                console.log('Match scores updated:', Object.keys(matchScores).length);
                displayGroupStandings();
                updateDrawStatus();
            });

            // Listen for match states
            database.ref('matchState').on('value', (snapshot) => {
                matchState = snapshot.val() || {};
                console.log('Match states updated:', Object.keys(matchState).length);
                displayGroupStandings();
                updateDrawStatus();
            });

            // Listen for quarter final draw
            database.ref('quarterFinalDraw').on('value', (snapshot) => {
                quarterFinalDraw = snapshot.val() || {};
                console.log('Quarter final draw updated:', quarterFinalDraw);
                updateDrawStatus();
                if (Object.keys(quarterFinalDraw).length > 0) {
                    displayDrawResult();
                }
            });
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            setupFirebaseListeners();
            
            // Hide loading and show content once data is loaded
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('main-content').style.display = 'grid';
            }, 2000);
        });
    </script>
</body>
</html>